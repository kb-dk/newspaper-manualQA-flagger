<!DOCTYPE html>
<html>
<head>
  <title>Batch Statistics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Newspaper batch statistics">
  <meta name="author" content="The State and University Library, Denmark">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <!-- Styles -->
  <link rel="stylesheet" type="text/css" href="xmltree/xmltree.css">
  <script src='jquery-2.0.3.min.js'></script>
  <script type="text/javascript" src="xmltree/xmltree.js"></script>
</head>
<body>
<h1>Batch Statistics</h1>
<span style="float:right">
<b>Looking for something specific ?   </b>
<input type="text" id="search_input" tabindex="-1" >
</span>
<div id='tree'></div>

<script>
  $(document).ready(function() {

    if ($('#tree').length > 0)
    {
      var filepath = 'statistics.xml'

      $(function() {
        new XMLTree({fpath: filepath, container: '#tree', startExpanded: false
        });

        $('ul[class="xmltree startExpanded"]').prop('id','xmltree');
      });

      jQuery.expr[':'].Contains = function(a,i,m){
        return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase())>=0;
      };

      //scroll to first child when filtering
      var container = $('body');

      $('#search_input').focus().keyup(function(e){
        var filter = $(this).val();
        if (filter) {
          $('#xmltree').find("li:not(:Contains(" + filter + "))").parent().hide();
          $('#xmltree').find("li:Contains(" + filter + ")").parent().show();
          $("#xmltree").find("li:Contains(" + filter + ")").children().show();
          $('#xmltree').highlight(filter);

          //scroll to first child when filtering
          var container = $('body');
          var scrollTo = $('#xmltree').children().find("li:Contains(" + filter + ")").first();

          console.log(scrollTo);
          container.scrollTop(
                  scrollTo.offset().top - container.offset().top + container.scrollTop()
          );
          //scroll to first child when filtering- ends
        }
        else {
          container.offset().top = 0;
          $('#xmltree').find("li").children().slideDown();
          $('#xmltree').unhighlight();
        }
      });

      $('#search_input').focus().keydown(function(e){
        $('#xmltree').unhighlight();
      });
    }
  });
</script>

</body>
</html>